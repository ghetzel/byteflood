---
bindings:
- name: shares
  resource: :/api{{ if .request.url.query.session }}/sessions/{{ .request.url.query.session }}/proxy{{ end }}/shares
  params:
    limit:  '{{ .request.url.query.limit }}'
    offset: '{{ or .request.url.query.offset 0 }}'
    sort:   '{{ .request.url.query.sort }}'
---
{{ $share := or .request.url.query.share `` }}
{{ $session := or .request.url.query.session `` }}
{{ $peer := or .request.url.query.peer `` }}
<div class="list-group">
    {{ if .bindings.shares }}
    {{ range .bindings.shares }}
    <button
        type="button"
        class="list-group-item list-group-item-action{{ if eq .id $share }} active{{ end }} justify-content-between"
        onclick="location.href='/shares/?share={{ .id }}{{ if $session }}&amp;session={{ $session }}&amp;peer={{ $peer }}{{ end }}'"
    >
        <span class="align-items-start">
            <i class="fa fa-fw fa-{{ or .icon_name `folder-o` }} mr-1"></i>
            {{ or .description .id }}
        </span>

        <script type="text/javascript" id="share_{{ or $session `local` }}_{{ .id }}">
            $(function(){
                $.ajax({
                    url: '/shares/_peer_share_stats?share={{ .id }}{{ if $session }}&session={{ $session }}{{ end }}',
                    success: function(data){
                        $('#share_{{ or $session `local` }}_{{ .id }}').replaceWith(data);
                    },
                });
            });
        </script>
    </button>
    {{ end }}
    {{ else }}
    <a class="list-group-item disabled">
        <i>No shares available.</i>
    </a>
    {{ end }}
</div>
