---
bindings:
- name: results
  resource: :/api{{ if .request.url.query.session }}/peers/{{ .request.url.query.session }}/proxy{{ end }}/shares/{{ .request.url.query.share }}/browse/{{ .request.url.query.parent }}
  params:
    limit: '{{ or .request.url.query.limit 15 }}'
    offset: '{{ or .request.url.query.offset 0 }}'
    sort:   '{{ .request.url.query.sort }}'
  optional: true
---
{{ $session := or .request.url.query.session `` }}
{{ $share := or .request.url.query.share `` }}
{{ $parent := or .request.url.query.parent `` }}
{{ $offset := or .request.url.query.offset 0 }}
{{ if .bindings.results }}
<div class="card">
  <div class="card-header">
    <b>File List</b>

    <form class="form-inline pull-right">
      <div class="form-group">
        <label for="browseAs">Browse As: </label>
        <select name="browseAs" class="form-control form-control-sm">
          <option>Files</option>
          <option>TV Shows</option>
          <option>Movies</option>
          <option>Music</option>
        </select>
      </div>
    </form>
  </div>

  {{ if .bindings.results.result_count }}
    {{ $page := .bindings.results.page }}
    {{ $perPage := .bindings.results.records_per_page }}
  <table class="table table-sm table-striped table-hover">
    <thead>
      <tr>
        <th>File Name</th>
        <th>Type</th>
        <th>Size</th>
        <th>&nbsp;</th>
      </tr>
    </thead>
    <tbody>
      {{ range .bindings.results.records }}
      <tr>
        <td>
          {{ if .fields.directory }}
          <a href="/shares/?share={{ $share }}&amp;parent={{ .id }}&amp;session={{ $session }}">{{ .fields.file.name }}</a>
          {{ else }}
          {{ .fields.file.name }}
          {{ end }}
        </td>
        <td>{{ .fields.file.extension }}</td>
        <td>
          {{ if .fields.file.size }}
          {{   autobyte .fields.file.size "%.f" }}
          {{ else }}
          &ndash;
          {{ end }}
        </td>
        <td>
          {{ if $session }}
          <a onclick="byteflood.queueFileForDownload('{{ $session }}', '{{ .id }}');">
            <i class="fa fa-fw fa-plus"></i>
          </a>
          {{ end }}
        </td>
      </tr>
      {{ end }}
    </tbody>
  </table>

  <div class="card-footer">
    <!-- {{ if gt (asInt .bindings.results.total_pages) 1 }}
    <nav aria-label="Share navigation" class="pull-left">
      <ul class="pagination pagination-sm mt-0 mb-0">
        <li class="page-item">
          <a
            class="page-link"
            href="?offset={{ multiply (asFloat $perPage) (asFloat $page) }}&amp;parent={{ $parent }}&amp;share={{ $share }}&amp;session={{ $session }}"
            aria-label="Previous"
          >
            <span aria-hidden="true">&laquo;</span>
            <span class="sr-only">Previous</span>
          </a>
        </li>

        {{ range $i := sequence .bindings.results.total_pages }}
        <li class="page-item">
          <a
            class="page-link"
            href="?offset={{ multiply (asFloat $perPage) (asFloat $i) }}&amp;parent={{ $parent }}&amp;share={{ $share }}&amp;session={{ $session }}"
          >{{ asFloat $i | add 1 }}</a>
        </li>
        {{ end }}

        <li class="page-item">
          <a
            class="page-link"
            href="?offset={{ add (asFloat $offset) 1 }}&amp;parent={{ $parent }}&amp;share={{ $share }}&amp;session={{ $session }}"
            aria-label="Next"
          >
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
          </a>
        </li>
      </ul>
    </nav>
    {{ end }} -->

    <span class="pull-right">
      Showing {{ len .bindings.results.records }}{{ if gt (asInt .bindings.results.total_pages) 1 }} of {{ .bindings.results.result_count }}{{ end }} results
    </span>
  </div>
  {{ else }}
  <div class="card-block">
    <p class="card-text">No files match the specified query.</p>
  </div>
  {{ end }}
</div>
{{ else }}
  <i class="fa fa-reply fa-4x"></i>
  <h2 class="mt-1">Select a share to browse files...</h2>
{{ end }}
