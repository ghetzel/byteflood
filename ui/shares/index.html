---
page:
  title: Shares
  local_interval: 5000
  peer_interval: 30000
bindings:
- name: sessions
  resource: :/api/sessions
---
{{ $session := or .request.url.query.session `` }}
{{ $view := or .request.url.query.view `files` }}
{{ $share := or .request.url.query.share `` }}
{{ $path := or .request.url.query.path `` }}
{{ $limit := or .request.url.query.limit `` }}
{{ $offset := or .request.url.query.offset `` }}
<div class="col-md-2">
    <ul class="nav bf-nav-tree">
        <!-- Local Shares Management -->
        <li class="nav-item">
          <span class="bf-nav-tree-title">
            Local

            <a class="pull-right" href="/shares/edit"><i class="fa fa-plus"></i></a>
          </span>

          <div
            bf-load="/shares/_peer_shares"
            bf-interval="{{ $.page.local_interval }}"
          ></div>
        </li>

        <!-- Remote Share Browser -->
        {{ range .bindings.sessions }}
        <li class="nav-item">
          <span class="bf-nav-tree-title">
            {{ .name }}

            <a
              class="pull-right"
              href="/api/sessions/{{ .session_id }}/proxy/"
              target="_blank"
            ><i class="fa fa-external-link-square"></i></a>
          </span>

          <div
            bf-load="/shares/_peer_shares?session={{ .session_id }}"
            bf-interval="{{ $.page.peer_interval }}"
          ></div>
        </li>
        {{ end }}
    </ul>
</div>

<div class="col-md-10">
  <script type="text/javascript" id="share-browser">
    $(function(){
      qs = {
        'limit': 15,
      };

      location.search.slice(1).split('&').map(function(i){
        var x = i.split('=');
        qs[x[0]] = x.splice(1).join('=');
        return [x[0], x.splice(1).join('=')];
      });

      $.ajax({
        url: '/shares/_peer_browse_{{ $view }}',
        data: qs,
        success: function(data){
          $('#share-browser').replaceWith(data);
        },
      });
    })
  </script>
</div>
