---
page:
  title: Shares
  local_interval: 120000
  peer_interval: 300000
bindings:
- name: sessions
  resource: :/api/sessions
---
{{ $session := or .request.url.query.session `` }}
{{ $share := or .request.url.query.share `` }}
{{ $view := or .request.url.query.view `files` }}
{{ $path := or .request.url.query.path `` }}
{{ $limit := or .request.url.query.limit `` }}
{{ $offset := or .request.url.query.offset `` }}
{{ $active := print (or $session `local`) `_` $share }}
<div class="row">
  <div class="col-lg-3">
      <ul class="nav flex-column bf-nav-tree">
          <!-- Local Shares Management -->
          <li class="nav-item mb-3">
            <div class="d-flex justify-content-between">
              <h4 class="bf-nav-tree-title">Local</h4>

              <div>
                <a class="btn btn-sm btn-success pull-right" href="/shares/edit">
                  <i class="fa fa-plus"></i> Add
                </a>
              </div>
            </div>

            <div
              bf-load="/shares/_peer_shares?share={{ $share }}&amp;active={{ $active }}"
              bf-interval="{{ $.page.local_interval }}"
            ></div>
          </li>

          <!-- Remote Share Browser -->
          {{ range .bindings.sessions }}
          <li class="nav-item mb-3">
            <div class="d-flex justify-content-between">
              <h4 class="bf-nav-tree-title">{{ .name }}</h4>

              <div>
                <a class="btn btn-sm btn-secondary" href="/peers/edit?id={{ .id }}">
                  <i class="fa fa-pencil"></i> Edit
                </a>
              </div>
            </div>

            <div
              bf-load="/shares/_peer_shares?session={{ .session_id }}&amp;share={{ $share }}&amp;peer={{ .name }}&amp;active={{ $active }}"
              bf-interval="{{ $.page.peer_interval }}"
            ></div>
          </li>
          {{ end }}
      </ul>
  </div>

  <div class="col-lg-9" id="share-browser">
    {{ if $share }}
    <script type="text/javascript">
      $(function(){
        qs = {
          'limit': 25,
        };

        location.search.slice(1).split('&').map(function(i){
          var x = i.split('=');
          qs[x[0]] = x.splice(1).join('=');
          return [x[0], x.splice(1).join('=')];
        });

        byteflood.loadInto('#share-browser', '/shares/_peer_browse_{{ $view }}', {
          payload: qs,
          error: false,
        });
      })
    </script>
    {{ end }}
  </div>
</div>
