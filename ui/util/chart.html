<div class="card">
    <div class="card-block">
        {{ $chart_id := replace uuid "-" "" -1 }}
        <canvas class="chart" id="chart_{{ $chart_id }}"></canvas>
        <script type="text/javascript">
        $(document).ready(function(){
            $.ajax('/api/metrics/query/byteflood.api.requests?interval=5m&from=-100h&group=status', {
                success: function(metrics){
                    var datasets = [];

                    $.each(metrics, function(_, metric){
                        var points = [];


                        $.each(metric.points, function(_, point){
                            points.push({
                                x: Date.parse(point.time),
                                y: point.value,
                            });
                        });

                        if(points.length) {
                            var name = metric.name;

                            name += ' {status:'+metric.tags['status']+'}';

                            datasets.push({
                                label: name,
                                data: points,
                            });
                        }
                    });

                    var chart = new Chart('chart_{{ $chart_id }}', {
                        type: 'line',
                        data: {
                            datasets: datasets,
                        },
                        options: {
                            scales: {
                                xAxes: [{
                                    type: 'time',
                                    position: 'bottom',
                                    time: {
                                        displayFormats: {
                                            quarter: 'MMM YYYY',
                                        },
                                    },
                                }],
                            }
                        }
                    });
                },
            });
        });
        </script>
    </div>
</div>
